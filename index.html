<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LEAF System Snapshot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root { --leaf:#43a419; }
    body{
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .glass{
      background: rgba(24,24,27,.78);
      backdrop-filter: blur(12px);
    }
    .soft-shadow{
      box-shadow: 0 18px 45px rgba(0,0,0,.42);
    }
    .pop{ transition: transform .18s ease; }
    .pop:hover{ transform: translateY(-1px) scale(1.01); }
    summary::-webkit-details-marker{ display:none; }

    /* --- SLIDERS (single-track look) --- */
    input[type="range"]{
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 32px;            /* room for thumb */
      background: transparent; /* IMPORTANT */
      outline: none;
      position: relative;
      z-index: 3;
    }

    /* Hide default track completely (we use .range-band) */
    input[type="range"]::-webkit-slider-runnable-track{
      height: 12px;
      background: transparent;
      border-radius: 999px;
    }
    input[type="range"]::-moz-range-track{
      height: 12px;
      background: transparent;
      border-radius: 999px;
    }

    /* Thumb */
    input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance: none;
      appearance: none;
      width: 30px;
      height: 30px;
      border-radius: 999px;
      background: var(--leaf);
      border: 2px solid rgba(0,0,0,.55);
      box-shadow: 0 12px 22px rgba(0,0,0,.45), 0 0 0 6px rgba(67,164,25,.12);
      cursor: pointer;
      margin-top: 1px;
      transform: translateZ(0);
    }
    input[type="range"]::-moz-range-thumb{
      width: 30px;
      height: 30px;
      border-radius: 999px;
      background: var(--leaf);
      border: 2px solid rgba(0,0,0,.55);
      box-shadow: 0 12px 22px rgba(0,0,0,.45), 0 0 0 6px rgba(67,164,25,.12);
      cursor: pointer;
      transform: translateZ(0);
    }

    .slider-wrap{
      position: relative;
      padding-top: 6px;
      padding-bottom: 6px;
    }

    /* Single visible track */
    .range-band{
      position: absolute;
      left: 0;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      height: 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.10);
      overflow: hidden;
      z-index: 1;
    }

    /* Fill-to-thumb glow */
    .range-band .fill{
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      width: 0%;
      border-radius: 999px;
      background: rgba(67,164,25,.18);
      z-index: 0;
      transition: width .06s linear;
    }

    /* LEAF ‚Äúin-range‚Äù highlight band */
    .range-band .ok{
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg,
        rgba(67,164,25,.18),
        rgba(67,164,25,.55),
        rgba(67,164,25,.18)
      );
      border: 1px solid rgba(67,164,25,.55);
      box-shadow:
        0 0 0 1px rgba(0,0,0,.25) inset,
        0 0 16px rgba(67,164,25,.22);
      z-index: 2;
      pointer-events: none;
    }

    /* Non-interactive marker (static bar) */
    .range-band .marker{
      position: absolute;
      top: -6px;
      width: 0;
      height: 26px;
      border-left: 2px solid rgba(255,255,255,.75);
      filter: drop-shadow(0 4px 10px rgba(0,0,0,.55));
      z-index: 3;
      pointer-events: none;
    }
    .range-band .marker::after{
      content:"";
      position:absolute;
      left:-6px;
      top:-2px;
      width: 12px;
      height: 12px;
      border-radius: 999px;
      background: var(--leaf);
      border: 2px solid rgba(0,0,0,.55);
      box-shadow: 0 10px 18px rgba(0,0,0,.40), 0 0 0 6px rgba(67,164,25,.10);
    }

    .band-label{
      font-size: 10px;
      color: rgba(255,255,255,.45);
      display:flex;
      justify-content: space-between;
      margin-top: 6px;
    }

    /* --- Reset feel --- */
    @keyframes softPop {
      0%   { transform: scale(1); }
      40%  { transform: scale(0.96); }
      100% { transform: scale(1); }
    }
    @keyframes thumbBounce {
      0%   { transform: scale(1); }
      40%  { transform: scale(0.90); }
      100% { transform: scale(1); }
    }
    @keyframes glowPulse {
      0%   { box-shadow: 0 0 0 0 rgba(67,164,25,.00); }
      50%  { box-shadow: 0 0 0 10px rgba(67,164,25,.14); }
      100% { box-shadow: 0 0 0 0 rgba(67,164,25,.00); }
    }
    .reset-pop { animation: softPop .22s ease; }
    .band-pulse { animation: glowPulse .28s ease; }
    input.thumb-bounce::-webkit-slider-thumb{ animation: thumbBounce .22s ease; }
    input.thumb-bounce::-moz-range-thumb{ animation: thumbBounce .22s ease; }
  </style>
</head>

<body class="bg-black text-white">
<div class="min-h-screen">

<header class="sticky top-0 z-30 bg-black/70 border-b border-neutral-800 backdrop-blur">
  <div class="max-w-md mx-auto px-4 py-3 flex items-center justify-between">
    <div>
      <div class="text-sm font-semibold">LEAF System Snapshot</div>
      <div class="text-[11px] text-neutral-400">Range-based upgrade guidance</div>
    </div>
    <div class="flex gap-2">
      <button class="text-xs px-3 py-2 rounded-full bg-neutral-900 border border-neutral-800 pop">Share</button>
      <button class="text-xs px-3 py-2 rounded-full bg-neutral-900 border border-neutral-800 pop">PDF</button>
    </div>
  </div>
</header>

<main class="max-w-md mx-auto px-4 pt-5 pb-28 space-y-4">

  <!-- HERO -->
  <section class="glass rounded-3xl p-4 border border-neutral-800 soft-shadow pop">
    <div class="text-xs uppercase text-neutral-400 mb-1">üî• HVAC ‚Ä¢ Gas Furnace</div>
    <div class="text-base font-semibold">Direct-replacement gas furnace upgrade</div>
    <div class="text-xs text-neutral-300 mt-1">
      LEAF provides ranges so you can evaluate contractor quotes with confidence.
    </div>
    <div class="flex flex-wrap gap-2 mt-3">
      <span id="heroSavingsPill" class="px-3 py-1 rounded-full bg-[var(--leaf)] text-black text-xs font-semibold">
        Save ~$19‚Äì$35/mo
      </span>
      <span class="px-3 py-1 rounded-full bg-emerald-500/15 text-emerald-200 text-xs border border-emerald-500/30">
        ~30‚Äì45% less CO‚ÇÇ
      </span>
    </div>
    <div class="text-[11px] text-neutral-400 mt-2">
      Note: higher-priced systems can increase savings slightly ‚Äî but ROI can drop if the added cost doesn‚Äôt pay back over time.
    </div>
  </section>

  <!-- CURRENT -->
  <section class="glass rounded-3xl p-4 border border-red-500/30 soft-shadow pop">
    <div class="flex justify-between mb-3">
      <div class="text-sm font-semibold">üì∑ Current system</div>
      <span class="text-[11px] px-3 py-1 rounded-full bg-red-500/15 text-red-200 border border-red-500/25">
        Near end of life
      </span>
    </div>
    <div class="flex gap-3">
      <div class="w-24 h-24 rounded-3xl overflow-hidden border border-neutral-800">
        <img src="old-furnace.png" class="w-full h-full object-cover" />
      </div>
      <div class="flex-1 text-xs space-y-1">
        <div class="font-semibold">Existing gas furnace</div>
        <div>Annual cost: <b>$350‚Äì$450</b></div>
        <div>Carbon: <b>3,400‚Äì4,000 lbs/yr</b></div>
      </div>
    </div>
  </section>

  <!-- RECOMMENDED -->
  <section class="glass rounded-3xl p-4 border border-[var(--leaf)]/35 soft-shadow pop">
    <div class="flex justify-between mb-3">
      <div class="text-sm font-semibold">‚ú® Recommended upgrade</div>
      <span class="text-[11px] px-3 py-1 rounded-full bg-emerald-500/15 text-emerald-200 border border-emerald-500/30">
        High efficiency
      </span>
    </div>
    <div class="flex gap-3">
      <div class="w-24 h-24 rounded-3xl overflow-hidden border border-neutral-800">
        <img src="new-furnace.png" class="w-full h-full object-cover" />
      </div>
      <div class="flex-1 text-xs space-y-1">
        <div class="font-semibold">High-efficiency gas furnace</div>
        <div>Estimated yearly savings: <b>$170‚Äì$260</b></div>
        <div>Carbon: <b>1,600‚Äì2,400 lbs/yr</b></div>
      </div>
    </div>
  </section>

  <!-- COST & SAVINGS RANGE -->
  <details class="glass rounded-3xl p-4 border border-neutral-800 soft-shadow pop">
    <summary class="cursor-pointer">
      <div class="flex justify-between items-center">
        <div class="text-sm font-semibold">üí∞ Cost & savings range</div>
        <span class="text-[11px] text-neutral-400">Tap for details</span>
      </div>
      <div class="grid grid-cols-2 gap-2 text-xs mt-3">
        <div class="rounded-2xl bg-neutral-900 border border-neutral-800 p-3">
          <div class="text-neutral-400">Install cost</div>
          <div class="text-lg font-bold">$5,000‚Äì$7,000</div>
        </div>
        <div class="rounded-2xl bg-neutral-900 border border-neutral-800 p-3">
          <div class="text-neutral-400">Monthly savings</div>
          <div class="text-lg font-bold" id="summarySavingsRange">$19‚Äì$35</div>
        </div>
      </div>
    </summary>

    <div class="mt-4 text-xs space-y-3">
      <div class="font-semibold">Cost bar (non-interactive)</div>

      <div class="rounded-2xl bg-neutral-900 border border-neutral-800 p-3">
        <div class="flex items-center justify-between">
          <div class="text-xs text-neutral-400">Your selected price</div>
          <div class="text-sm font-bold" id="staticPriceValue">$6,000</div>
        </div>

        <div class="mt-3 slider-wrap" style="padding-top:14px; padding-bottom:10px;">
          <div class="range-band" aria-hidden="true" id="staticCostTrack">
            <div id="staticCostFill" class="fill"></div>
            <div id="staticCostOK" class="ok"></div>
            <div id="staticCostMarker" class="marker" style="left:0%;"></div>
          </div>
          <div class="band-label">
            <span id="staticCostMinLabel">$5,000</span>
            <span id="staticCostMaxLabel">$7,000</span>
          </div>
        </div>

        <div class="mt-2 text-[11px] text-neutral-400">
          LEAF range is highlighted. The marker shows your selected quote.
        </div>
      </div>

      <div class="font-semibold">Why it‚Äôs a range</div>
      <ul class="list-disc list-inside text-neutral-300 space-y-1">
        <li>Based on similar installs in comparable homes</li>
        <li>Accounts for typical labor, permits, and equipment size</li>
        <li>Premium options can slightly increase savings, but ROI may drop if cost climbs faster than savings</li>
        <li>Final scope can change due to ductwork/access/electrical needs</li>
      </ul>
    </div>
  </details>

  <!-- INTERACTIVE COST SLIDER + QUICK READ -->
  <section class="glass rounded-3xl p-4 border border-neutral-800 soft-shadow pop">
    <div class="flex items-start justify-between gap-3">
      <div>
        <div class="text-sm font-semibold">üéöÔ∏è Test your quote</div>
        <div class="text-[11px] text-neutral-400 mt-1">
          Slide the price. Savings bumps slightly with higher system cost ‚Äî but ROI can drop if price rises faster than savings.
        </div>
      </div>

      <div class="flex items-center gap-2">
        <button id="resetBtn"
          class="text-[11px] px-3 py-1 rounded-full bg-neutral-900 border border-neutral-800 pop">
          Reset
        </button>

        <!-- CHANGED: square badge (no full rounding) -->
        <span id="overallBadge" class="text-[11px] px-3 py-1 rounded-md bg-emerald-500/15 text-emerald-200 border border-emerald-500/30">
          Looks good ‚úÖ
        </span>
      </div>
    </div>

    <!-- Price slider card -->
    <div class="mt-4 rounded-2xl bg-neutral-900 border border-neutral-800 p-3">
      <div class="flex items-center justify-between">
        <div class="text-xs text-neutral-400">Contractor price</div>
        <div class="flex items-center gap-2">
          <span id="costBadge" class="text-[11px] px-3 py-1 rounded-full bg-emerald-500/15 text-emerald-200 border border-emerald-500/30">
            Within range
          </span>
          <div class="text-sm font-bold" id="priceValue">$6,000</div>
        </div>
      </div>

      <div class="mt-3 slider-wrap">
        <div class="range-band" aria-hidden="true" id="priceBandTrack">
          <div id="priceBandFill" class="fill"></div>
          <div id="priceBandOK" class="ok"></div>
        </div>
        <input id="priceSlider" type="range" min="3000" max="15000" step="100" value="6000" />
        <div class="band-label">
          <span id="priceBandMinLabel">$5,000</span>
          <span id="priceBandMaxLabel">$7,000</span>
        </div>
      </div>

      <div class="mt-2 text-[11px] text-neutral-400">
        LEAF price range: <b>$5,000‚Äì$7,000</b>
      </div>

      <div class="mt-2 text-[11px] text-neutral-400">
        Estimated savings at this price: <b id="dynamicSavingsRange">$19‚Äì$35/mo</b>
      </div>
    </div>

    <!-- QUICK READ -->
    <div class="mt-3 rounded-2xl bg-black/30 border border-neutral-800 p-3">
      <div class="text-xs text-neutral-400">Quick read</div>
      <div class="text-sm font-semibold mt-1" id="overallHeadline">This looks like a solid deal.</div>

      <div class="mt-2 text-[11px] text-neutral-300">
        <div class="font-semibold text-neutral-200">Good questions to ask the contractor</div>
        <ul id="quickReadQuestionsVisible" class="list-disc list-inside mt-1 space-y-1"></ul>
      </div>

      <details class="mt-2">
        <summary class="cursor-pointer text-[11px] text-emerald-300">
          Why this message + more questions
        </summary>

        <div class="mt-2 text-[11px] text-neutral-300 space-y-3">
          <div>
            <div class="font-semibold text-neutral-200">Why LEAF is saying this</div>
            <ul id="quickReadWhy" class="list-disc list-inside mt-1 space-y-1"></ul>
          </div>

          <div>
            <div class="font-semibold text-neutral-200">More questions (optional)</div>
            <ul id="quickReadQuestionsMore" class="list-disc list-inside mt-1 space-y-1"></ul>
          </div>
        </div>
      </details>
    </div>
  </section>

  <!-- INCENTIVES -->
  <details class="glass rounded-3xl p-4 border border-neutral-800 soft-shadow pop">
    <summary class="cursor-pointer">
      <div class="flex justify-between items-center">
        <div class="text-sm font-semibold">üè∑Ô∏è Incentives & rebates</div>
        <span class="text-[11px] text-neutral-400">Tap for details</span>
      </div>
      <div class="mt-2 text-xs font-bold">$750‚Äì$3,000+ typical</div>
      <div class="text-[11px] text-neutral-400 mt-1">Federal ‚Ä¢ State ‚Ä¢ Utility</div>
    </summary>

    <div class="mt-4 space-y-3 text-xs">
      <div class="rounded-2xl bg-neutral-900 border border-neutral-800 p-3">
        <div class="font-semibold">üá∫üá∏ Federal</div>
        <div>Tax credit example: <b>20‚Äì30%</b> up to <b>$600‚Äì$2,000</b></div>
        <div class="text-[11px] text-neutral-400 mt-1">Claimed by homeowner when filing taxes.</div>
      </div>

      <div class="rounded-2xl bg-neutral-900 border border-neutral-800 p-3">
        <div class="font-semibold">üèõÔ∏è State</div>
        <div>Program rebates often <b>$500‚Äì$1,500</b> (varies by state & funding)</div>
        <div class="text-[11px] text-neutral-400 mt-1">Eligibility can depend on equipment + participating contractors.</div>
      </div>

      <div class="rounded-2xl bg-neutral-900 border border-neutral-800 p-3">
        <div class="font-semibold">‚ö° Local / Utility</div>
        <div>Flat rebates typically <b>$250‚Äì$750</b></div>
        <div class="text-[11px] text-neutral-400 mt-1">Often applied at install or submitted after completion.</div>
      </div>

      <div class="rounded-2xl bg-neutral-900 border border-neutral-800 p-3">
        <div class="font-semibold">üîó Helpful links</div>
        <div class="mt-2 flex flex-col gap-2">
          <a href="https://www.irs.gov/pub/irs-pdf/f5695.pdf" target="_blank"
            class="text-emerald-300 underline text-[11px]">
            IRS Form 5695 (PDF)
          </a>
          <a href="https://www.energystar.gov/rebate-finder" target="_blank"
            class="text-emerald-300 underline text-[11px]">
            ENERGY STAR Rebate Finder
          </a>
        </div>
      </div>

      <div class="text-[11px] text-neutral-400">
        LEAF identifies likely incentives based on system type and location. Contractors confirm eligibility,
        pricing, and paperwork requirements.
      </div>
    </div>
  </details>

  <!-- DOES THIS MAKE SENSE? -->
  <section class="glass rounded-3xl p-4 border border-neutral-800 soft-shadow pop">
    <div class="flex items-center justify-between">
      <div class="text-sm font-semibold">üß† Does this decision make sense?</div>
      <span id="decisionBadge" class="text-[11px] px-3 py-1 rounded-full bg-emerald-500/15 text-emerald-200 border border-emerald-500/30">
        Likely yes ‚úÖ
      </span>
    </div>

    <div class="mt-3 grid grid-cols-2 gap-2 text-xs">
      <div class="rounded-2xl bg-neutral-900 border border-neutral-800 p-3">
        <div class="text-neutral-400">Install cost (slider)</div>
        <div class="text-base font-bold" id="msInstallCost">$6,000</div>
      </div>

      <div class="rounded-2xl bg-neutral-900 border border-neutral-800 p-3">
        <div class="text-neutral-400">Estimated savings (at this price)</div>
        <div class="text-base font-bold" id="msSavingsRange">$19‚Äì$35/mo</div>
        <div class="text-[11px] text-neutral-400 mt-1">Higher cost can bump savings slightly, but ROI may drop.</div>
      </div>

      <div class="rounded-2xl bg-neutral-900 border border-neutral-800 p-3 col-span-2">
        <div class="text-neutral-400">Estimated net cost (after incentives)</div>
        <div class="text-base font-bold" id="msNetCostRange">$3,500‚Äì$4,500</div>
        <div class="text-[11px] text-neutral-400 mt-1">
          Based on incentive estimates shown above (contractor confirms final eligibility).
        </div>
      </div>

      <div class="rounded-2xl bg-neutral-900 border border-neutral-800 p-3">
        <div class="text-neutral-400">Quote value check</div>
        <div class="text-base font-bold" id="msValueCheck">Within range ‚úÖ</div>
      </div>
      <div class="rounded-2xl bg-neutral-900 border border-neutral-800 p-3">
        <div class="text-neutral-400">What this means</div>
        <div class="text-[11px] text-neutral-300 mt-1" id="msMeaning">
          Quotes in-range usually indicate predictable scope + fair pricing.
        </div>
      </div>
    </div>

    <div class="mt-3 rounded-2xl bg-black/30 border border-neutral-800 p-3">
      <div class="text-xs text-neutral-400">Decision summary</div>
      <div class="text-sm font-semibold mt-1" id="msSummaryHeadline">This looks financially reasonable.</div>
      <div class="text-[11px] text-neutral-300 mt-1" id="msSummaryText">
        If the contractor quote lands within the LEAF ranges, this is typically a strong replacement decision.
      </div>
    </div>
  </section>

</main>

<!-- CTA -->
<div class="fixed bottom-0 inset-x-0 bg-black/80 border-t border-neutral-800 backdrop-blur">
  <div class="max-w-md mx-auto px-4 py-3">
    <button class="w-full bg-[var(--leaf)] text-black font-semibold py-3 rounded-full text-sm pop">
      üîé Get an exact bid from a contractor
    </button>
    <div class="text-[11px] text-neutral-400 text-center mt-1">
      Compare the quote against your LEAF range
    </div>
  </div>
</div>

</div>

<script>
  // -------------------------
  // LEAF BASE INPUTS
  // -------------------------
  const LEAF_PRICE_MIN = 5000;
  const LEAF_PRICE_MAX = 7000;

  const BASE_SAVINGS_MIN = 19;  // $/mo
  const BASE_SAVINGS_MAX = 35;  // $/mo

  const INCENTIVES_LOW  = 750;
  const INCENTIVES_HIGH = 3000;

  const COST_UNREALISTIC_BELOW = LEAF_PRICE_MIN - 500;
  const COST_OVERPRICED_ABOVE  = LEAF_PRICE_MAX + 3000;

  // -------------------------
  // DOM
  // -------------------------
  const priceSlider = document.getElementById("priceSlider");

  const priceValue = document.getElementById("priceValue");
  const staticPriceValue = document.getElementById("staticPriceValue");

  const costBadge = document.getElementById("costBadge");

  const overallBadge = document.getElementById("overallBadge");
  const overallHeadline = document.getElementById("overallHeadline");

  const quickReadWhy = document.getElementById("quickReadWhy");
  const quickReadQuestionsVisible = document.getElementById("quickReadQuestionsVisible");
  const quickReadQuestionsMore = document.getElementById("quickReadQuestionsMore");

  const decisionBadge = document.getElementById("decisionBadge");

  const priceBandOK = document.getElementById("priceBandOK");
  const priceBandFill = document.getElementById("priceBandFill");
  const priceBandMinLabel = document.getElementById("priceBandMinLabel");
  const priceBandMaxLabel = document.getElementById("priceBandMaxLabel");

  const dynamicSavingsRangeLabel = document.getElementById("dynamicSavingsRange");
  const summarySavingsRange = document.getElementById("summarySavingsRange");
  const heroSavingsPill = document.getElementById("heroSavingsPill");
  const msSavingsRange = document.getElementById("msSavingsRange");

  const msInstallCost = document.getElementById("msInstallCost");
  const msNetCostRange = document.getElementById("msNetCostRange");
  const msValueCheck = document.getElementById("msValueCheck");
  const msMeaning = document.getElementById("msMeaning");
  const msSummaryHeadline = document.getElementById("msSummaryHeadline");
  const msSummaryText = document.getElementById("msSummaryText");

  const resetBtn = document.getElementById("resetBtn");
  const priceBandTrack = document.getElementById("priceBandTrack");

  const staticCostFill = document.getElementById("staticCostFill");
  const staticCostOK = document.getElementById("staticCostOK");
  const staticCostMarker = document.getElementById("staticCostMarker");
  const staticCostMinLabel = document.getElementById("staticCostMinLabel");
  const staticCostMaxLabel = document.getElementById("staticCostMaxLabel");

  // -------------------------
  // HELPERS
  // -------------------------
  const formatMoney = (n) => "$" + Math.round(n).toLocaleString("en-US");
  const clamp = (v, min, max) => Math.min(max, Math.max(min, v));

  function setBadge(el, tone, text){
    const tones = {
      good: "bg-emerald-500/15 text-emerald-200 border border-emerald-500/30",
      warn: "bg-yellow-500/15 text-yellow-200 border border-yellow-500/30",
      bad:  "bg-red-500/15 text-red-200 border border-red-500/25",
      neutral: "bg-neutral-800/60 text-neutral-200 border border-neutral-700"
    };
    el.className = `text-[11px] px-3 py-1 ${el.id === "overallBadge" ? "rounded-md" : "rounded-full"} ${tones[tone] || tones.neutral}`;
    el.textContent = text;
  }

  function setBand(okEl, sliderMin, sliderMax, okMin, okMax){
    const span = sliderMax - sliderMin;
    const leftPct = ((okMin - sliderMin) / span) * 100;
    const rightPct = ((okMax - sliderMin) / span) * 100;
    const L = Math.max(0, Math.min(100, leftPct));
    const R = Math.max(0, Math.min(100, rightPct));
    okEl.style.left = `${L}%`;
    okEl.style.width = `${Math.max(0, R - L)}%`;
  }

  function setFill(fillEl, sliderMin, sliderMax, value){
    const span = sliderMax - sliderMin;
    const pct = ((value - sliderMin) / span) * 100;
    fillEl.style.width = `${clamp(pct, 0, 100)}%`;
  }

  function setMarker(markerEl, sliderMin, sliderMax, value){
    const span = sliderMax - sliderMin;
    const pct = ((value - sliderMin) / span) * 100;
    markerEl.style.left = `${clamp(pct, 0, 100)}%`;
  }

  function dynamicSavingsRange(price){
    const over = Math.max(0, price - LEAF_PRICE_MAX);
    const steps = Math.floor(over / 1000);
    const bump = steps * 2; // +$2/mo per $1k above max
    return { min: BASE_SAVINGS_MIN + bump, max: BASE_SAVINGS_MAX + bump };
  }

  function classifyCost(price){
    if (price < COST_UNREALISTIC_BELOW) return "unreal_low";
    if (price < LEAF_PRICE_MIN) return "low";
    if (price > COST_OVERPRICED_ABOVE) return "over";
    if (price > LEAF_PRICE_MAX) return "likely_over";
    return "in";
  }

  function quickReadMessage(costClass){
    const premiumWhy = [
      "More expensive systems can provide slightly higher savings (better efficiency/controls/commissioning) ‚Äî usually incremental.",
      "ROI can drop when cost climbs faster than savings. A premium quote should come with clear, measurable value."
    ];

    if (costClass === "unreal_low"){
      return {
        tone: "warn",
        headline: "This price is extremely low ‚Äî verify scope before scheduling.",
        why: [
          "Very low pricing often means partial scope or missing line items.",
          "Confirming scope protects you from surprise add-ons later."
        ],
        qVisible: [
          "Is this a full replacement quote (equipment, labor, permits, startup/commissioning)?",
          "What‚Äôs excluded that could be added later (venting, thermostat, disposal, permits)?"
        ],
        qMore: [
          "Can you itemize model numbers + warranty terms in writing?",
          "Is there any scenario where price changes after work begins?"
        ]
      };
    }

    if (costClass === "low"){
      return {
        tone: "good",
        headline: "Competitive quote ‚Äî great sign if scope is complete.",
        why: [
          "Competitive bids happen and can be a win for the homeowner.",
          "A quick scope check ensures it‚Äôs apples-to-apples."
        ],
        qVisible: [
          "Can you walk me through exactly what‚Äôs included in this price?",
          "Are permits/inspections and commissioning included?"
        ],
        qMore: [
          "Is the thermostat included? What about haul-away/disposal?",
          "Can you confirm final scope and model numbers in writing?"
        ]
      };
    }

    if (costClass === "in"){
      return {
        tone: "good",
        headline: "This looks like a fair, in-range quote.",
        why: [
          "Pricing aligns with what LEAF typically sees for this replacement category.",
          "In-range quotes usually indicate predictable scope and fewer surprises."
        ],
        qVisible: [
          "What‚Äôs the install timeline and what prep do you need from me?",
          "What warranty coverage comes with the equipment and labor?"
        ],
        qMore: [
          "Do you handle permits and inspection sign-off?",
          "What maintenance keeps performance strong long-term?"
        ]
      };
    }

    if (costClass === "likely_over"){
      return {
        tone: "warn",
        headline: "Higher than LEAF range ‚Äî confirm what‚Äôs driving the price.",
        why: [
          "Higher quotes can be justified by site conditions (access, venting, ductwork, electrical).",
          "It can also reflect premium add-ons you may not need.",
          ...premiumWhy
        ],
        qVisible: [
          "What specifically is driving the price above typical range?",
          "Is there a simpler option that still meets the goals?"
        ],
        qMore: [
          "Can you provide an itemized quote so I can compare bids accurately?",
          "Which add-ons are optional vs required?"
        ]
      };
    }

    return {
      tone: "warn",
      headline: "Major caution ‚Äî this looks overpriced for the category.",
      why: [
        "This is significantly above typical replacement pricing.",
        "Before committing, compare at least one more itemized bid.",
        ...premiumWhy
      ],
      qVisible: [
        "Can you itemize the quote (equipment, labor, permits, extras) line-by-line?",
        "What would the ‚Äòstandard replacement‚Äô option cost and what changes?"
      ],
      qMore: [
        "Are there scope items here that belong in a separate project (duct redesign, electrical upgrades)?",
        "Can you confirm model numbers and efficiency details to justify pricing?"
      ]
    };
  }

  function computeNetCostRange(installCost){
    const netLow = Math.max(0, installCost - INCENTIVES_HIGH);
    const netHigh = Math.max(0, installCost - INCENTIVES_LOW);
    return { netLow, netHigh };
  }

  function formatMoneyRange(a, b){
    return `${formatMoney(a)}‚Äì${formatMoney(b)}`;
  }

  function nudgeAnim(el, cls){
    if (!el) return;
    el.classList.remove(cls);
    void el.offsetWidth;
    el.classList.add(cls);
    setTimeout(() => el.classList.remove(cls), 320);
  }

  function thumbBounce(inputEl){
    if (!inputEl) return;
    inputEl.classList.remove("thumb-bounce");
    void inputEl.offsetWidth;
    inputEl.classList.add("thumb-bounce");
    setTimeout(() => inputEl.classList.remove("thumb-bounce"), 260);
  }

  function resetToLeafMid(){
    const midPrice = Math.round((LEAF_PRICE_MIN + LEAF_PRICE_MAX) / 2);
    nudgeAnim(resetBtn, "reset-pop");
    if (navigator.vibrate) navigator.vibrate([10]);
    priceSlider.value = midPrice;
    thumbBounce(priceSlider);
    nudgeAnim(priceBandTrack, "band-pulse");
    updateUI();
  }

  resetBtn?.addEventListener("click", resetToLeafMid);

  function updateUI(){
    const price = Number(priceSlider.value);

    priceValue.textContent = formatMoney(price);
    staticPriceValue.textContent = formatMoney(price);

    const dynSav = dynamicSavingsRange(price);
    const savText = `$${dynSav.min}‚Äì$${dynSav.max}/mo`;

    dynamicSavingsRangeLabel.textContent = savText;
    summarySavingsRange.textContent = `$${dynSav.min}‚Äì$${dynSav.max}`;
    heroSavingsPill.textContent = `Save ~$${dynSav.min}‚Äì$${dynSav.max}/mo`;
    msSavingsRange.textContent = savText;

    priceBandMinLabel.textContent = formatMoney(LEAF_PRICE_MIN);
    priceBandMaxLabel.textContent = formatMoney(LEAF_PRICE_MAX);

    setBand(priceBandOK, Number(priceSlider.min), Number(priceSlider.max), LEAF_PRICE_MIN, LEAF_PRICE_MAX);
    setFill(priceBandFill, Number(priceSlider.min), Number(priceSlider.max), price);

    staticCostMinLabel.textContent = formatMoney(LEAF_PRICE_MIN);
    staticCostMaxLabel.textContent = formatMoney(LEAF_PRICE_MAX);
    setBand(staticCostOK, Number(priceSlider.min), Number(priceSlider.max), LEAF_PRICE_MIN, LEAF_PRICE_MAX);
    setFill(staticCostFill, Number(priceSlider.min), Number(priceSlider.max), price);
    setMarker(staticCostMarker, Number(priceSlider.min), Number(priceSlider.max), price);

    const costClass = classifyCost(price);
    if (costClass === "unreal_low"){
      setBadge(costBadge, "bad", "Unrealistic");
    } else if (costClass === "low"){
      setBadge(costBadge, "warn", "Low (verify scope)");
    } else if (costClass === "over"){
      setBadge(costBadge, "bad", "Overpriced");
    } else if (costClass === "likely_over"){
      setBadge(costBadge, "warn", "Likely overpriced");
    } else {
      setBadge(costBadge, "good", "Within range");
    }

    const msg = quickReadMessage(costClass);

    if (costClass === "over"){
      setBadge(overallBadge, "bad", "Major caution üö©");
      overallHeadline.textContent = msg.headline;
    } else if (msg.tone === "good"){
      setBadge(overallBadge, "good", "Looks good ‚úÖ");
      overallHeadline.textContent = msg.headline;
    } else {
      setBadge(overallBadge, "warn", "Proceed smart ‚ö†Ô∏è");
      overallHeadline.textContent = msg.headline;
    }

    const renderList = (el, items) => {
      el.innerHTML = (items || []).map(t => `<li>${t}</li>`).join("");
    };
    renderList(quickReadWhy, msg.why);
    renderList(quickReadQuestionsVisible, msg.qVisible);
    renderList(quickReadQuestionsMore, msg.qMore);

    msInstallCost.textContent = formatMoney(price);

    const net = computeNetCostRange(price);
    const netMin = Math.min(net.netLow, net.netHigh);
    const netMax = Math.max(net.netLow, net.netHigh);
    msNetCostRange.textContent = formatMoneyRange(netMin, netMax);

    if (costClass === "in"){
      msValueCheck.textContent = "Within range ‚úÖ";
      msMeaning.textContent = "Quotes in-range usually indicate predictable scope + fair pricing.";
    } else if (costClass === "low"){
      msValueCheck.textContent = "Below range ‚ö†Ô∏è";
      msMeaning.textContent = "Could be a great deal ‚Äî just confirm it‚Äôs a full scope replacement quote.";
    } else if (costClass === "unreal_low"){
      msValueCheck.textContent = "Very low üö©";
      msMeaning.textContent = "High chance something is missing. Get scope in writing before scheduling.";
    } else if (costClass === "likely_over"){
      msValueCheck.textContent = "Above range ‚ö†Ô∏è";
      msMeaning.textContent = "Premium cost can bump savings slightly, but ROI may drop. Ask what justifies the cost.";
    } else {
      msValueCheck.textContent = "Far above range üö©";
      msMeaning.textContent = "This is likely overpriced. Compare another itemized bid before committing.";
    }

    if (costClass === "over"){
      setBadge(decisionBadge, "bad", "Unclear üö©");
      msSummaryHeadline.textContent = "This needs a closer look.";
      msSummaryText.textContent =
        "The quote is well above typical range. Request an itemized scope and compare at least one more bid.";
    } else if (costClass === "in"){
      setBadge(decisionBadge, "good", "Likely yes ‚úÖ");
      msSummaryHeadline.textContent = "This looks financially reasonable.";
      msSummaryText.textContent =
        "If the contractor quote lands within the LEAF range, this is typically a strong replacement decision.";
    } else {
      setBadge(decisionBadge, "warn", "Likely yes (with clarity) ‚ö†Ô∏è");
      msSummaryHeadline.textContent = "This can still make sense ‚Äî confirm a few details.";
      msSummaryText.textContent =
        "Use the questions above to confirm scope and what‚Äôs driving price. Premium cost can bump savings slightly, but ROI often drops if price rises too fast.";
    }
  }

  priceSlider.addEventListener("input", updateUI);
  updateUI();
</script>

</body>
</html>
